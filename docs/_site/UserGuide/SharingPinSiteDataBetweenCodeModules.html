<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Sharing SiteData and PinSiteData Between Code Modules | Semiconductor Test Library </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Sharing SiteData and PinSiteData Between Code Modules | Semiconductor Test Library ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ni/semi-test-library-dotnet/blob/users/mattjet27/add-initial-documentation/docs/UserGuide/SharingPinSiteDataBetweenCodeModules.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="Semiconductor Test Library">
            Semiconductor Test Library
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="sharing-sitedata-and-pinsitedata-between-code-modules">Sharing SiteData and PinSiteData Between Code Modules</h1>

<p>During test development, it may become necessary to store some results measured in one code module with another code module later in the test sequence execution, within the same run. This can be achieved by storing the data within in the SemiconductorModuleContext in one code module and retrieving later in another code module using an ID string. For more information, refer the <a href="https://www.ni.com/docs/bundle/teststand-semiconductor-module/page/sharing-data-between-code-modules.html">Sharing Data between Code Modules (TSM)</a> topic in the TSM help documentation.</p>
<p>The <code>SetSiteData</code> and <code>GetSiteData</code> .NET methods provided by TSM, do not currently support being passed SiteData or PinSiteData objects directly. Therefore, SiteData/PinSiteData must first be converted into a 1D array of per-site values. Where, each element in the array represents a given site values. In the case of PinSiteData, this will be each element in the array a dictionary of per-pin values that represents a given site.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The data must be ordered to match the order of sites in the Semiconductor Module context. This order might not be sequential. Use the <code>SiteNumbers</code> property on the <code>ISemiconductorModuleContext</code> .NET object to determine the order of the sites in the Semiconductor Module context and arrange the data manually.</p>
</div>
<h2 id="sharing-sitedata-example">Sharing SiteData Example</h2>
<p>The following example shows how to store a per-site measurement data for comparison in a later test step:</p>
<pre><code class="lang-C#">public static void FirstCodeModule(
    ISemiconductorModuleContext semiconductorModuleContext,
    string pinName,
    string patternName,
    string waveformName,
    int samplesToRead)
{
    var sessionManager = new TSMSessionManager(semiconductorModuleContext);
    var digitalPins = sessionManager.Digital(pinName);
    digitalPins.BurstPattern(patternName);
    SiteData&lt;uint[]&gt; measurement = digitalPins.FetchCaptureWaveform(waveformName, samplesToRead);

    var perSiteDataArray = new uint[semiconductorModuleContext.SiteNumbers.Count][];
    for (int i = 0; i &lt; perSiteDataArray.Length; i++)
    {
        perSiteDataArray[i] = measurement.GetValue(semiconductorModuleContext.SiteNumbers.ElementAt(i));
    }
    semiconductorModuleContext.SetSiteData(&quot;ComparisonData&quot;, perSiteDataArray);
}

public static void SecondCodeModule(
    ISemiconductorModuleContext semiconductorModuleContext,
    string pinName,
    string patternName,
    string waveformName,
    int samplesToRead)
{
    var perSiteComparisonDataArray = semiconductorModuleContext.GetSiteData&lt;uint[]&gt;(&quot;ComparisonData&quot;);
    var comparisonData = new SiteData&lt;uint[]&gt;(perSiteComparisonDataArray);

    var sessionManager = new TSMSessionManager(semiconductorModuleContext);
    var digitalPins = sessionManager.Digital(pinName);
    digitalPins.BurstPattern(patternName);
    SiteData&lt;uint[]&gt; measurement = digitalPins.FetchCaptureWaveform(waveformName, 1);

    var comparisonResults = measurement.Compare(ComparisonType.EqualTo, comparisonData);
    semiconductorModuleContext.PublishResults(comparisonResults, &quot;ComparisonResults&quot;);
}
</code></pre>
<h2 id="sharing-pinsitedata-example">Sharing PinSiteData Example</h2>
<p>The following example shows how to store a per-pin per-site measurement data for comparison in a later test step:</p>
<pre><code class="lang-C#">public static void FirstCodeModule(ISemiconductorModuleContext semiconductorModuleContext, string pinName)
{
    var sessionManager = new TSMSessionManager(semiconductorModuleContext);
    var dcPowerPin = sessionManager.DCPower(pinName);
    PinSiteData&lt;double&gt; measurement = dcPowerPin.MeasureVoltage();

    var perSiteDataArray = new IDictionary&lt;string, double&gt;[semiconductorModuleContext.SiteNumbers.Count];
    for (int i = 0; i &lt; perSiteDataArray.Length; i++)
    {
        perSiteDataArray[i] = measurement.ExtractSite(semiconductorModuleContext.SiteNumbers.ElementAt(i));
    }
    semiconductorModuleContext.SetSiteData(&quot;ComparisonData&quot;, perSiteDataArray);
}

public static void SecondCodeModule(ISemiconductorModuleContext semiconductorModuleContext, string pinName)
{
    var perSitePinDict = semiconductorModuleContext.GetSiteData&lt;IDictionary&lt;string, double&gt;&gt;(&quot;ComparisonData&quot;);
    var pinSiteDictionary = new Dictionary&lt;string, IDictionary&lt;int, double&gt;&gt;();
    for (int i = 0; i &lt; semiconductorModuleContext.SiteNumbers.Count; i++)
    {
        var siteNumber = semiconductorModuleContext.SiteNumbers.ElementAt(i);
        foreach (var pin in perSitePinDict[i].Keys)
        {
            var singlePinSiteValue = perSitePinDict[i][pin];
            if (!pinSiteDictionary.TryGetValue(pin, out IDictionary&lt;int, double&gt; perSitePinValues))
            {
                perSitePinValues = new Dictionary&lt;int, double&gt;() { [siteNumber] = singlePinSiteValue };
                pinSiteDictionary.Add(pin, perSitePinValues);
                continue;
            }
            if (!perSitePinValues.ContainsKey(siteNumber))
            {
                perSitePinValues.Add(siteNumber, singlePinSiteValue);
                continue;
            }
            perSitePinValues[siteNumber] = singlePinSiteValue;
        }
    }
    var comparisonData = new PinSiteData&lt;double&gt;(pinSiteDictionary);

    var sessionManager = new TSMSessionManager(semiconductorModuleContext);
    var dcPowerPin = sessionManager.DCPower(pinName);
    PinSiteData&lt;double&gt; measurement = dcPowerPin.MeasureVoltage();

    var comparisonResults = measurement.Subtract(comparisonData);
    semiconductorModuleContext.PublishResults(comparisonResults, &quot;ComparisonResults&quot;);
}
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ni/semi-test-library-dotnet/blob/users/mattjet27/add-initial-documentation/docs/UserGuide/SharingPinSiteDataBetweenCodeModules.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
